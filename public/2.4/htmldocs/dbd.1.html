<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>dbd</title>
    <link rel="stylesheet" type="text/css" href="https://netatalk.io/css/netatalk.css" />
    <meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" />
    <link rel="home" href="index.html" title="Netatalk Manual" />
    <link rel="up" href="man-pages.html" title="Chapter 5. Manual Pages" />
    <link rel="prev" href="cnid2_create.1.html" title="cnid2_create" />
    <link rel="next" href="getzones.1.html" title="getzones" />
  </head>
  <body>
    <div xmlns="" id="header">
        <div id="logo"></div>
        <div id="menlinks">
          <a href="/" title="Return to Netatalk home">[main]</a>
          <a href="/docs" title="Netatalk Wiki">[wiki]</a>
          <a href="/documentation.html" title="Netatalk Manual">[documentation]</a>
          <a href="/download.html" title="Download Netatalk">[downloads]</a>
          <a href="/support.html" title="Support">[support]</a>
          <a href="/links.html" title="Netatalk related links">[links]</a>
          <img src="/gfx/end.gif" alt="" width="125" height="7" />
        </div>
    </div>
    <div xmlns="" class="navheader" align="center">Netatalk 2.4.8</div>
<div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">dbd</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="cnid2_create.1.html">Prev</a> </td><th width="60%" align="center">Chapter 5. Manual Pages</th><td width="20%" align="right"> <a accesskey="n" href="getzones.1.html">Next</a></td></tr></table><hr /></div><div class="refentry"><a id="dbd.1"></a><div class="titlepage"></div><div class="refnamediv"><h2>Name</h2><p>dbd — CNID database maintenance</p></div><div class="refsynopsisdiv"><h2>Synopsis</h2><div class="cmdsynopsis"><p><code class="command">dbd</code>  [-evx] { -d [-i]  |   -s [-c|-n]  |   -r [-c|-f]  |   -u }  <em class="replaceable"><code>volumepath</code></em> </p></div></div><div class="refsect1"><a id="id-1.8.23.4"></a><h2>Description</h2><p><span class="command"><strong>dbd</strong></span> can dump, scan, reindex and rebuild
    <span class="emphasis"><em>Netatalk</em></span> dbd CNID databases. It must be run with
    appropriate permissions i.e. as root. <span class="command"><strong>dbd</strong></span>
    <code class="option">-s|-r</code> can be run on active volumes, but 
    <span class="command"><strong>dbd -rf</strong></span>, which wipes the db before rebuilding it,
    checks and enforces that the chosen volume is not in use.</p></div><div class="refsect1"><a id="id-1.8.23.5"></a><h2>Commands</h2><div class="variablelist"><dl class="variablelist"><dt><span class="term">-d</span></dt><dd><p>Dump CNID database. With <code class="option">-i </code>dump indexes
          too.</p></dd><dt><span class="term">-s</span></dt><dd><p>Scan volume:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Compare CNIDs in database with volume</p></li><li class="listitem"><p>Test if .AppleDouble directories exist</p></li><li class="listitem"><p>Test if AppleDouble files exist</p></li><li class="listitem"><p>Report orphaned AppleDouble files</p></li><li class="listitem"><p>Report directories inside .AppleDouble directories</p></li><li class="listitem"><p>Check name encoding by roundtripping, log on error</p></li><li class="listitem"><p>Check for orphaned CNIDs in database (requires
              <code class="option">-e</code>)</p></li><li class="listitem"><p>Open and close adouble files</p></li></ul></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Options:</span></dt><dd><p><code class="option">-c</code> Don't check .AppleDouble stuff, only
                check orphaned.</p><p><code class="option">-n</code> Don't open CNID database, skip CNID
                checks, only traverse filesystem</p></dd></dl></div></dd><dt><span class="term">-r</span></dt><dd><p>Rebuild volume. With <code class="option">-f</code> wipe database and
          rebuild from CNIIDs stored in AppleDouble files.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Sync CNIDSs from database with volume</p></li><li class="listitem"><p>Ensure .AppleDouble directories exist</p></li><li class="listitem"><p>Ensure AppleDouble files exist</p></li><li class="listitem"><p>Delete orphaned AppleDouble files</p></li><li class="listitem"><p>Report directories inside .AppleDouble directories</p></li><li class="listitem"><p>Check name encoding by roundtripping, log on error</p></li><li class="listitem"><p>Delete orphaned CNIDs in database (requires
              <code class="option">-e</code>)</p></li><li class="listitem"><p>Open and close adouble files</p></li></ul></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Options:</span></dt><dd><p><code class="option">-c</code> Don't create .AppleDouble stuff,
                only cleanup orphaned.</p><p><code class="option">-f</code> Wipe database and rebuild from IDs
                stored in AppleDouble files, only available for volumes
                without <code class="option">nocnidcache</code> option. Implies
                <code class="option">-e</code>.</p></dd></dl></div></dd><dt><span class="term">-u</span></dt><dd><p>Upgrade:</p><p>Opens the database which triggers any necessary upgrades, then
            closes and exits.</p></dd></dl></div></div><div class="refsect1"><a id="id-1.8.23.6"></a><h2>Options</h2><div class="variablelist"><dl class="variablelist"><dt><span class="term">-e</span></dt><dd><p>Only work on inactive volumes and lock them (exclusive)</p></dd><dt><span class="term">-x</span></dt><dd><p>Rebuild indexes (just for completeness, mostly
          useless!)</p></dd><dt><span class="term">-v</span></dt><dd><p>verbose</p></dd></dl></div></div><div class="refsect1"><a id="id-1.8.23.7"></a><h2>Warning</h2><p>In order to be able to run <code class="option">-rf</code> reconstructing the
    CNIDs in the database from the <span class="emphasis"><em>AppleDouble</em></span> files,
    make sure you've run a <code class="option">-r</code> rebuild sometimes before, where
    the CNIDs then would have been synched between database and
    <span class="emphasis"><em>AppleDouble</em></span> files.</p><p>Also be careful about the option <code class="option">nocnidcache</code>. Avoid
    this option if at all possible, because if prevents you from being able to
    use <code class="option">-f</code>.</p></div><div class="refsect1"><a id="id-1.8.23.8"></a><h2>CNID background</h2><p>The CNID backends maintains name to ID mappings. If you change a
    filename outside afpd(8) (shell, samba), the CNID db will not know and not
    reflect that change. Netatalk tries to recover from such inconsistencies
    as gracefully as possible. The mechanisms to resolve such inconsistencies
    may fail sometimes, though, as this is not an easy task to accomplish.
    E.g. if several names in the path to the file or directory have changed,
    things may go wrong.</p><p>If you change a lot of filenames at once, chances are higher that
    the afpds fallback mechanisms fail, i.e. files will be assigned new IDs,
    even though the file hasn't changed.</p></div><div class="refsect1"><a id="id-1.8.23.9"></a><h2>See also</h2><p><span class="citerefentry"><span class="refentrytitle">cnid_metad</span>(8)</span>, <span class="citerefentry"><span class="refentrytitle">cnid_dbd</span>(8)</span></p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="cnid2_create.1.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="man-pages.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="getzones.1.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">cnid2_create </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> getzones</td></tr></table></div></body>
</html>
