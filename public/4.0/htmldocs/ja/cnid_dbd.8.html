<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>cnid_dbd</title>
    <link rel="stylesheet" type="text/css" href="/css/netatalk.css" />
    <meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" />
    <link rel="home" href="index.html" title="Netatalk マニュアル" />
    <link rel="up" href="man-pages.html" title="第6章 マニュアルページ" />
    <link rel="prev" href="atalk_aton.3.html" title="atalk_aton" />
    <link rel="next" href="cnid_metad.8.html" title="cnid_metad" />
  </head>
  <body>
    <div xmlns="" id="header">
        <div id="logo"></div>
        <div id="menlinks">
          <a href="/" title="Netatalk ホームに戻る">[main]</a>
          <a href="/docs" title="Netatalk Wiki">[wiki]</a>
          <a href="/documentation.html" title="Netatalk マニュアル">[documentation]</a>
          <a href="/download.html" title="Netatalk をダウンロード">[downloads]</a>
          <a href="/support.html" title="お問い合わせ">[support]</a>
          <a href="/links.html" title="Netatalk 関連リンク">[links]</a>
          <img src="/gfx/end.gif" alt="" width="125" height="7" />
        </div>
    </div>
    <div xmlns="" class="navheader" align="center">Netatalk 4.0.1</div>
<div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">cnid_dbd</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="atalk_aton.3.html">戻る</a> </td><th width="60%" align="center">第6章 マニュアルページ</th><td width="20%" align="right"> <a accesskey="n" href="cnid_metad.8.html">次へ</a></td></tr></table><hr /></div><div class="refentry"><a id="cnid_dbd.8"></a><div class="titlepage"></div><div class="refnamediv"><h2>名前</h2><p>cnid_dbd — CNIDデータベースへのアクセスデーモン</p></div><div class="refsynopsisdiv"><h2>概要</h2><div class="cmdsynopsis"><p><code class="command">cnid_dbd</code> </p></div><div class="cmdsynopsis"><p><code class="command">cnid_dbd</code>    -v  |   -V  </p></div></div><div class="refsect1"><a id="id-1.9.19.4"></a><h2>説明</h2><p><span class="command"><strong>cnid_dbd</strong></span>はストレージとカタログノードID
    (CNID)と関連情報の検索のためのインターフェースを<span class="emphasis"><em>afpd</em></span>デーモンに提供する。CNIDはMacintoshベースのファイルシステムの構成要素であるが、これの動作は単純にはUnixファイルシステム上にマッピングできない。従って、一つのデータベース内に分離した記憶域が必要となる。<span class="command"><strong>cnid_dbd</strong></span>は<span class="emphasis"><em>afpd</em></span>の<span class="emphasis"><em>CNIDバックエンド</em></span>の一つであり、<span class="emphasis"><em>dbd</em></span>バックエンドを実装する。</p><p><span class="command"><strong>cnid_dbd</strong></span>はコマンドラインやシステム起動スクリプトではなく、<span class="emphasis"><em>cnid_metad</em></span>デーモンによって起動する。netatalkボリューム一つにつき、<span class="command"><strong>cnid_dbd</strong></span>のインスタンスが一つである。</p><p><span class="command"><strong>cnid_dbd</strong></span>は<span class="emphasis"><em>Berkeley
    DB</em></span>データベースライブラリを用いて、トランザクションで保護したアップデートを行う。トランザクションによる<span class="emphasis"><em>dbd</em></span>バックエンドは、たとえシステムが不意にクラッシュしても、CNIDデータベースの破損を防ぐだろう。</p><p><span class="command"><strong>cnid_dbd</strong></span>は起動時に<span class="emphasis"><em>cnid_metad</em></span>からの有効なユーザIDとグループIDを継承する。普通、この動作はnetatalkボリュームをクライアントへ提供する<span class="emphasis"><em>afpd</em></span>によって生じる。それはボリュームに関連付けられた<span class="emphasis"><em>Berkeley DB</em></span>データベースのホームディレクトリ<span class="emphasis"><em>dbdir</em></span>を変更する。もし<span class="emphasis"><em>cnid_metad</em></span>から継承したユーザIDが0
    (root)ならば、<span class="command"><strong>cnid_dbd</strong></span>はユーザIDとグループIDをデータベースホームディレクトリの所有者とグループに変更する。そうでない場合は、継承した値を使い続ける。このとき、<span class="command"><strong>cnid_dbd</strong></span>はデータベースを開き、ファイル記述子<span class="emphasis"><em>clntfd</em></span>を使って要求されたものを提供開始する。同じボリュームへアクセスしようとする次の<span class="emphasis"><em>afpd</em></span>のインスタンスは、ファイル記述子<span class="emphasis"><em>ctrlfd</em></span>を用いる<span class="emphasis"><em>cnid_metad</em></span>によって、既に動いている<span class="command"><strong>cnid_dbd</strong></span>へリダイレクトされる。</p><p><span class="command"><strong>cnid_dbd</strong></span>は、永久に動作するか、または不活性期間の後に終了するかを設定できる。もし<span class="command"><strong>cnid_dbd</strong></span>がTERMやINTシグナルを受け取った場合、汚れたデータベースバッファをディスクにフラッシュし、<span class="emphasis"><em>Berkeley
    DB</em></span>データベース環境を閉じてから、綺麗に終了する。この方法で<span class="command"><strong>cnid_dbd</strong></span>を終了するのは安全な事であり、もし必要なら再起動する。他のシグナルは処理されず、即座に終了するか、もしかすると(トランザクションなしのとき)CNIDデータベースを矛盾した状態のままにしておくか、(トランザクションありのとき)リカバリ中の直近の更新を失うかするだろう。</p><p><span class="emphasis"><em>Berkeley
    DB</em></span>データベースサブシステムは、データベースのホームディレクトリ<span class="emphasis"><em>dbdir</em></span>にlog.xxxxxxxxxxという名前のファイルを作る。ここでxxxxxxxxxxは、単調増加する整数である。これらのファイルにはトランザクションにおけるデータベースの変更が記載されている。これらのファイルは、<span class="emphasis"><em>db_param</em></span>設定ファイル(以下を見よ)で<span class="emphasis"><em>logfile_autoremove</em></span>の値が0
    (デフォルトは1)に設定されている場合を除いて、定期的に削除される。</p></div><div class="refsect1"><a id="id-1.9.19.5"></a><h2>オプション</h2><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-v, -V</code></span></dt><dd><p>バージョンを表示してから終了する。</p></dd></dl></div></div><div class="refsect1"><a id="id-1.9.19.6"></a><h2>設定</h2><p><span class="command"><strong>cnid_dbd</strong></span>は起動時、データベースディレクトリ<span class="emphasis"><em>dbdir</em></span> の中のファイル<span class="emphasis"><em>db_param</em></span>から設定情報を読む。ファイルがない場合やパラメータが載っていない場合、適切なデフォルト値が使われる。ひとつのパラメータのフォーマットは、まずパラメータ名、それに続く一つ以上のスペース、それに続くパラメータ値、それに続く改行で構成される。現在以下のパラメータが認識される:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="emphasis"><em>logfile_autoremove</em></span></span></dt><dd><p>もし0を設定した場合、<span class="command"><strong>cnid_dbd</strong></span>の起動時に未使用のBerkeley
          DBトランザクションのログファイル(データベースホームディレクトリの中のlog.xxxxxxxxxx)の定期的な削除が行われない。デフォルトは1。</p></dd><dt><span class="term"><span class="emphasis"><em>cachesize</em></span></span></dt><dd><p>Berkeley
          DBのキャッシュサイズをキロバイト単位で決定する。デフォルトは8192。それぞれの<span class="command"><strong>cnid_dbd</strong></span>プロセスは通常のメモリ占有量に加えて大量のメモリを獲得する。これはデータベースのパフォーマンスを調整するのに使われる。Berkeley
          DBに附属する<span class="emphasis"><em>db_stat</em></span>ユーティリティに<code class="option">-m</code>オプションを付けると、この値を変更すべきかどうかを決定するのに役立つ。デフォルトではキャッシュが要求の大半を丁度良く満たすように極めて保守的な値になっている。メモリがシステムのボトルネックにならないなら、あなたはその値を放置してよい。<span class="emphasis"><em>Berkeley DB Tutorial and Reference
          Guide</em></span>には、より詳しい情報を記した<span class="emphasis"><em>Selecting a cache
          size</em></span>という章がある。</p></dd><dt><span class="term"><span class="emphasis"><em>flush_frequency</em></span>, </span><span class="term"><span class="emphasis"><em>flush_interval</em></span></span></dt><dd><p><span class="emphasis"><em>flush_frequency</em></span> (デフォルト:
          1000)と<span class="emphasis"><em>flush_interval</em></span> (デフォルト:
          1800)はデータベースへの変更を書き戻す頻度を制御する。これらの両方動作は、i) <span class="emphasis"><em>flush_frequency</em></span>を越える要求を受け取った場合、ii)
          最後の保存/書き戻しから<span class="emphasis"><em>flush_interval</em></span>秒よりも経過した場合のどちらかで実行される。ディスクキャッシュ設定のため、あなたのハードディスク設定の確認に慎重を期してください。多くのIDEディスクはデフォルト動作では書き込みを単にキャッシュするだけです。従って、たとえデータベースファイルをフラッシュしても期待した効果は得られないでしょう。</p></dd><dt><span class="term"><span class="emphasis"><em>fd_table_size</em></span></span></dt><dd><p><span class="emphasis"><em>afpd</em></span>クライアントが<span class="emphasis"><em>cnid_dbd</em></span>で処理するために開く最大の接続数(ファイル記述子数)。デフォルトは512。この値を超えた場合、存在する接続のうち一つを閉じて再利用する。影響を受けた<span class="emphasis"><em>afpd</em></span>プロセスは後に透過的に再接続される。これは僅かなオーバヘッドを生じる。一方、全ての記述子を<code class="function">select()</code>システムコールでチェックしなければならないので、このパラメータを極めて高い値に設定すると<span class="command"><strong>cnid_dbd</strong></span>のパフォーマンスに影響するかもしれないし、更に悪いことにプロセスあたりに開くファイル記述子のシステム上の上限を超えるかもしれない。たった一つの<span class="emphasis"><em>afpd</em></span>クライアントプロセスが動作すると予想されるボリュームでは、この値を1に設定すると安全である。例えばホームディレクトリである。</p></dd><dt><span class="term"><span class="emphasis"><em>idle_timeout</em></span></span></dt><dd><p>アイドリング中の<span class="command"><strong>cnid_dbd</strong></span>が終了するまでの静止状態の秒数。デフォルトは600。これを0に設定するとタイムアウトが無効になる。</p></dd></dl></div></div><div class="refsect1"><a id="id-1.9.19.7"></a><h2>アップデート</h2><p>Netatalk 2.1の<span class="emphasis"><em>後</em></span>に出た最初のバージョン、すなわちNetatalk
    2.1.1は、手動操作なしに自動的にBerkeley DBアップデートをサポートすることに注意せよ。言い換えると、Netatalk
    2.1はBerkeley
    DBデータベースのアップグレードを準備するコードと、既に準備されている場合にそれをアップグレードするコードを含んでいる。これはバージョン2.0.xからはアップグレードできないことを意味する。なぜならデータベースの準備をしていないからである。</p><p>異なるバージョンのBerkeley
    DBライブラリを使っている古いNetatalkをアップデートするためには、以下の手順をとります:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>これからアップグレードする古いバージョンのNetatalkを停止する</p></li><li class="listitem"><p>古いBerkeley DBユーティリティを使って、<span class="command"><strong>db_recover -h
        &lt;.AppleDBのパス&gt;</strong></span> を実行する</p></li><li class="listitem"><p>新しいBerkeley DBユーティリティを使って、<span class="command"><strong>db_upgrade -v -h
        &lt;.AppleDBのパス&gt; -f cnid2.db</strong></span> を実行する</p></li><li class="listitem"><p>再び新しいBerkeley DBユーティリティを使って、<span class="command"><strong>db_checkpoint -1 -h
        &lt;.AppleDBのパス&gt;</strong></span> を実行する</p></li><li class="listitem"><p>新しいバージョンのNetatalkを起動する</p></li></ul></div></div><div class="refsect1"><a id="id-1.9.19.8"></a><h2>参照</h2><p><span class="citerefentry"><span class="refentrytitle">cnid_metad</span>(8)</span>, <span class="citerefentry"><span class="refentrytitle">afpd</span>(8)</span>, <span class="citerefentry"><span class="refentrytitle">dbd</span>(1)</span></p></div><div class="refsect1"><a id="id-1.9.19.9"></a><h2>著作者</h2><p><a class="ulink" href="https://github.com/Netatalk/netatalk/blob/main/CONTRIBUTORS" target="_top">CONTRIBUTORS</a>を参照</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="atalk_aton.3.html">戻る</a> </td><td width="20%" align="center"><a accesskey="u" href="man-pages.html">上に戻る</a></td><td width="40%" align="right"> <a accesskey="n" href="cnid_metad.8.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">atalk_aton </td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top"> cnid_metad</td></tr></table></div></body>
</html>
