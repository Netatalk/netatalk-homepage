<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Netatalk Wiki - MacIP Gateway</title>
    <meta name="description" content="Netatalk Wiki">
    <link rel="canonical" href="https://netatalk.io/docs/MacIP-Gateway">
    <link rel="stylesheet" type="text/css" href="https://netatalk.io/css/site.css" />
    <link rel="icon" type="image/x-icon" href="https://netatalk.io/gfx/favicon.ico" />
</head>
<body>
<div id="header">
    <div id="logo"></div>
    <div id="menlinks">
        <a href="/" title="Return to Netatalk home">[main]</a>
        <a href="/docs" title="Netatalk Wiki">[wiki]</a>
        <a href="/documentation.html" title="Netatalk Manual">[documentation]</a>
        <a href="/download.html" title="Download Netatalk">[downloads]</a>
        <a href="/support.html" title="Support">[support]</a>
        <a href="/links.html" title="Netatalk related links">[links]</a>
        <img src="/gfx/end.gif" alt="" width="125" height="7" />
    </div>
</div>

<div id="header-print">
    <h1>netatalk.io</h1>
</div>

<div class="search">
    <h2>search netatalk.io</h2>
    <form method="get" action="https://www.google.com/search">
        <p>
            <input type="text" name="q" size="10" maxlength="255" value="" title="enter search text" />
            <input type="hidden" name="sitesearch" value="netatalk.io" />
            <input type="submit" name="btnG" value="Go" title="search netatalk.io" />
        </p>
    </form>
    <span class="italic">powered by Google</span>
</div>

<div id="navbars">
<div class="navbar">
<h2>Table of contents</h2>
<p>Resources</p>
<ul>
<li><a class="wikilink" href="/docs/FAQ.html">FAQ</a></li>
<li><a class="wikilink" href="/docs/Troubleshooting.html">Troubleshooting</a></li>
<li><a class="wikilink" href="/docs/Connect-to-AFP-Server.html">Connect to AFP Server</a></li>
<li><a class="wikilink" href="/docs/Webmin-Module.html">Webmin Module</a></li>
<li><a class="wikilink" href="/docs/Benchmarks.html">Benchmarks</a></li>
</ul>
<p>OS Specific Guides</p>
<ul>
<li><a class="wikilink" href="/docs/Installing-Netatalk-on-Alpine-Linux.html">Installing Netatalk on Alpine Linux</a></li>
<li><a class="wikilink" href="/docs/Installing-Netatalk-on-Debian-Linux.html">Installing Netatalk on Debian Linux</a></li>
<li><a class="wikilink" href="/docs/Installing-Netatalk-on-Fedora-Linux.html">Installing Netatalk on Fedora Linux</a></li>
<li><a class="wikilink" href="/docs/Installing-Netatalk-on-FreeBSD.html">Installing Netatalk on FreeBSD</a></li>
<li><a class="wikilink" href="/docs/Installing-Netatalk-on-macOS.html">Installing Netatalk on macOS</a></li>
<li><a class="wikilink" href="/docs/Installing-Netatalk-on-NetBSD.html">Installing Netatalk on NetBSD</a></li>
<li><a class="wikilink" href="/docs/Installing-Netatalk-on-OmniOS.html">Installing Netatalk on OmniOS</a></li>
<li><a class="wikilink" href="/docs/Installing-Netatalk-on-OpenBSD.html">Installing Netatalk on OpenBSD</a></li>
<li><a class="wikilink" href="/docs/Installing-Netatalk-on-OpenIndiana.html">Installing Netatalk on OpenIndiana</a></li>
<li><a class="wikilink" href="/docs/Installing-Netatalk-on-openSUSE.html">Installing Netatalk on openSUSE</a></li>
<li><a class="wikilink" href="/docs/Installing-Netatalk-on-Solaris.html">Installing Netatalk on Solaris</a></li>
<li><a class="wikilink" href="/docs/Installing-Netatalk-on-Ubuntu.html">Installing Netatalk on Ubuntu</a></li>
</ul>
<p>Technical Docs</p>
<ul>
<li><a class="wikilink" href="/docs/CatalogSearch.html">CatalogSearch</a></li>
<li><a class="wikilink" href="/docs/Kerberos.html">Kerberos</a></li>
<li><a class="wikilink" href="/docs/Special-Files-and-Folders.html">Special Files and Folders</a></li>
<li><a class="wikilink" href="/docs/Spotlight.html">Spotlight</a></li>
<li><a class="wikilink" href="/docs/AppleTalk-Kernel-Module.html">AppleTalk Kernel Module</a></li>
<li><a class="wikilink" href="/docs/Print-Server.html">Print Server</a></li>
<li><a class="wikilink" href="/docs/MacIP-Gateway.html">MacIP Gateway</a></li>
</ul>
<p>Development</p>
<ul>
<li><a class="wikilink" href="/docs/Developer-Notes.html">Developer Notes</a></li>
<li><a class="wikilink" href="/docs/Developer-FAQ.html">Developer FAQ</a></li>
<li><a class="wikilink" href="/docs/Work-with-Documentation.html">Work with Documentation</a></li>
<li><a class="wikilink" href="/docs/Release-Process.html">Release Process</a></li>
<li><a class="wikilink" href="/docs/Using-GDB-to-Analyze-a-Crash.html">Using GDB to Analyze a Crash</a></li>
</ul>
</div></div>
<div id="content">
<h1 id="MacIP-Gateway">MacIP Gateway</h1><hr/>
<p>As of Netatalk 4.0.0, we bundle Stefan Bethke&rsquo;s <a href="https://macipgw.sourceforge.io/">macipgw daemon</a> in our tarball, enabling you to build and launch it as any other Netatalk daemon.</p>
<p>The <code>macipgw</code> daemon provides a <a href="https://en.wikipedia.org/wiki/MacIP">MacIP</a> gateway that allow old Macs to use the MacIP network stack to access TCP/IP resources from a LocalTalk network.</p>
<p>Previously, <code>macipgw</code> was a stand-alone daemon that linked against Netatalk&rsquo;s libatalk shared library to access the AppleTalk stack and <code>atalkd</code> network management daemon.</p>
<p>In order to use the Mac IP gateway, you need to configure a network tunnel and IPv4 packet forwarding.</p>
<p>On Linux, this can be done with f.e. iptables or nft. On *BSD you can use pf or npf. You may need to set up NAT (Network Address Translation) .</p>
<p>When launching <code>macipgw</code>, choose a subnet address and mask that doesn&rsquo;t conflict with the rest of your network. For the nameserver, you can use your own or a public DNS server such as Google&rsquo;s (<code>8.8.8.8</code> and <code>8.8.4.4</code>).</p>
<p>If you want to see debug information, launch it with an appropriate debug flag with <code>-d</code>, example below that enables all debug logging.</p>
<pre><code>macipgw -d0x111 -n 8.8.8.8 192.168.151.0 255.255.255.0
</code></pre>
<h1>Mac client</h1>
<p>Make sure your Mac has MacTCP or Open Transport installed. From for instance the TCP/IP control panel, choose the &ldquo;MacIP&rdquo; network stack. Let the server assign the IP address. Pick the correct AppleTalk zone if the server is defining one.</p>
<p>Once both the server and client have synchronized with the AppleTalk network, you should see both of them represented in the NBP cache, f.e.:</p>
<pre><code>$ nbplkup 
                  192.168.151.1:IPGATEWAY                          65280.21:72
                          alien:TimeLord                           65280.21:129
                          alien:AFPServer                          65280.21:128
                          alien:netatalk                           65280.21:4
                          alien:Workstation                        65280.21:4
                  192.168.151.2:IPADDRESS                          65280.177:72
                         rescue:AFPServer                          65280.177:253
                         rescue:Workstation                        65280.177:4
</code></pre>
<p>When the gateway and tunnel are up and running, you should be able to browse the web or access an AFP-over-TCP server from the Mac.</p>
<h1>Caveats</h1>
<p>The Linux kernel has a feature called IPDDP which unfortunately filters out the traffic that the MacIP gateway relies on. This feature was <a href="https://github.com/torvalds/linux/commit/85605fb694f084ba017c93c150e668882445ce73">removed from the Linux kernel</a> in version 6.7. If you are using an earlier version, you need to recompile your kernel with IPDDP disabled. Later versions of the kernel should work out of the box.</p>
<h1>See also</h1>
<ul>
<li><a href="https://netatalk.io/stable/htmldocs/macipgw.8">macipgw manual page</a></li>
<li><a href="https://github.com/NJRoadfan/a2server/blob/currentdev/files/macipgw-start.sh.txt">Example of NAT configuration on Debian Linux</a>, from A2SERVER</li>
</ul><hr />
    <p>
        This is a mirror of the Netatalk GitHub Wiki.
        Please <a href="https://github.com/Netatalk/netatalk/wiki/MacIP-Gateway">visit the original page</a>
        if you want to correct an error or contribute new contents.
    </p>
    <p>Last updated 2024-10-02</p>
    <hr />
    </div>
<div class="footer">
    <a href="https://validator.w3.org/check?uri=referer">
      <img src="https://www.w3.org/Icons/valid-xhtml10" alt="Valid XHTML 1.0 Strict" height="31" width="88" />
    </a>
    <a href="https://jigsaw.w3.org/css-validator/check?uri=referer">
      <img style="border:0;width:88px;height:31px"
      src="https://jigsaw.w3.org/css-validator/images/vcss" alt="Valid CSS!" />
    </a>
</div>
</body>
</html>

