<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Netatalk Wiki - Release Process</title>
    <meta name="description" content="Netatalk Wiki">
    <link rel="canonical" href="https://netatalk.io/docs/Release-Process">
    <link rel="stylesheet" type="text/css" href="https://netatalk.io/css/site.css" />
    <link rel="icon" type="image/x-icon" href="https://netatalk.io/gfx/favicon.ico" />
</head>
<body>
<div id="header">
    <div id="logo"></div>
    <div id="menlinks">
        <a href="/" title="Return to Netatalk home">[main]</a>
        <a href="/docs" title="Netatalk Wiki">[wiki]</a>
        <a href="/documentation.html" title="Netatalk Manual">[documentation]</a>
        <a href="/download.html" title="Download Netatalk">[downloads]</a>
        <a href="/support.html" title="Support">[support]</a>
        <a href="/links.html" title="Netatalk related links">[links]</a>
        <img src="/gfx/end.gif" alt="" width="125" height="7" />
    </div>
</div>

<div id="header-print">
    <h1>netatalk.io</h1>
</div>

<div class="search">
    <h2>search netatalk.io</h2>
    <form method="get" action="https://www.google.com/search">
        <p>
            <input type="text" name="q" size="10" maxlength="255" value="" title="enter search text" />
            <input type="hidden" name="sitesearch" value="netatalk.io" />
            <input type="submit" name="btnG" value="Go" title="search netatalk.io" />
        </p>
    </form>
    <span class="italic">powered by Google</span>
</div>

<div id="navbars">
<div class="navbar">
<h2>Table of contents</h2>
<p>Resources</p>
<ul>
<li><a class="wikilink" href="/docs/FAQ.html">FAQ</a></li>
<li><a class="wikilink" href="/docs/Troubleshooting.html">Troubleshooting</a></li>
<li><a class="wikilink" href="/docs/Connect-to-AFP-Server.html">Connect to AFP Server</a></li>
<li><a class="wikilink" href="/docs/Webmin-Module.html">Webmin Module</a></li>
<li><a class="wikilink" href="/docs/Benchmarks.html">Benchmarks</a></li>
</ul>
<p>Netatalk v3 Installation</p>
<ul>
<li><a class="wikilink" href="/docs/Installing-Netatalk-3-on-Fedora-Linux.html">Installing Netatalk 3 on Fedora Linux</a></li>
<li><a class="wikilink" href="/docs/Installing-Netatalk-3-on-FreeBSD.html">Installing Netatalk 3 on FreeBSD</a></li>
<li><a class="wikilink" href="/docs/Installing-Netatalk-3-on-macOS.html">Installing Netatalk 3 on macOS</a></li>
<li><a class="wikilink" href="/docs/Installing-Netatalk-3-on-OpenBSD.html">Installing Netatalk 3 on OpenBSD</a></li>
<li><a class="wikilink" href="/docs/Installing-Netatalk-3-on-OpenIndiana.html">Installing Netatalk 3 on OpenIndiana</a></li>
<li><a class="wikilink" href="/docs/Installing-Netatalk-3-on-openSUSE.html">Installing Netatalk 3 on openSUSE</a></li>
<li><a class="wikilink" href="/docs/Installing-Netatalk-3-on-Solaris.html">Installing Netatalk 3 on Solaris</a></li>
<li><a class="wikilink" href="/docs/Installing-Netatalk-3-on-Ubuntu.html">Installing Netatalk 3 on Ubuntu</a></li>
</ul>
<p>Netatalk v2 Installation</p>
<ul>
<li><a class="wikilink" href="/docs/Installing-Netatalk-2-on-Alpine-Linux.html">Installing Netatalk 2 on Alpine Linux</a></li>
<li><a class="wikilink" href="/docs/Installing-Netatalk-2-on-Debian-Linux.html">Installing Netatalk 2 on Debian Linux</a></li>
<li><a class="wikilink" href="/docs/Installing-Netatalk-2-on-Fedora-Linux.html">Installing Netatalk 2 on Fedora Linux</a></li>
<li><a class="wikilink" href="/docs/Installing-Netatalk-2-on-macOS.html">Installing Netatalk 2 on macOS</a></li>
<li><a class="wikilink" href="/docs/Installing-Netatalk-2-on-NetBSD.html">Installing Netatalk 2 on NetBSD</a></li>
<li><a class="wikilink" href="/docs/Installing-Netatalk-2-on-OmniOS.html">Installing Netatalk 2 on OmniOS</a></li>
</ul>
<p>Technical Docs</p>
<ul>
<li><a class="wikilink" href="/docs/CatalogSearch.html">CatalogSearch</a></li>
<li><a class="wikilink" href="/docs/Kerberos.html">Kerberos</a></li>
<li><a class="wikilink" href="/docs/Special-Files-and-Folders.html">Special Files and Folders</a></li>
<li><a class="wikilink" href="/docs/Spotlight.html">Spotlight</a></li>
<li><a class="wikilink" href="/docs/AppleTalk-Kernel-Module.html">AppleTalk Kernel Module</a></li>
<li><a class="wikilink" href="/docs/Print-Server.html">Print Server</a></li>
</ul>
<p>Development</p>
<ul>
<li><a class="wikilink" href="/docs/Developer-Notes.html">Developer Notes</a></li>
<li><a class="wikilink" href="/docs/Developer-FAQ.html">Developer FAQ</a></li>
<li><a class="wikilink" href="/docs/Work-with-Documentation.html">Work with Documentation</a></li>
<li><a class="wikilink" href="/docs/Release-Process.html">Release Process</a></li>
<li><a class="wikilink" href="/docs/Using-GDB-to-Analyze-a-Crash.html">Using GDB to Analyze a Crash</a></li>
</ul>
</div></div>
<div id="content">
<h1 id="Release-Process">Release Process</h1><hr/>
<p>Process for preparing and publishing Netatalk releases. The intended audience for this document is Netatalk project maintainers.</p>
<h2>Making a stable release</h2>
<ul>
<li>Bump version number</li>
</ul>
<p>First, use an editor to edit <code>./meson.build</code> and update the &ldquo;version&rdquo; line near the top. Then:</p>
<pre><code>$ echo &quot;3.2.0&quot; &gt; VERSION
$ git commit -a -m &quot;Bump version to 3.2.0&quot;
</code></pre>
<p><em>(We temporarily need to update the version number in two places, because of supporting both Meson and Autotools build systems.)</em></p>
<ul>
<li>Update NEWS as necessary:</li>
</ul>
<pre><code>$ vi NEWS
$ git commit -a -m &quot;Update NEWS&quot;
</code></pre>
<ul>
<li>Build netatalk with manual and tests (requires <code>docbook-xsl</code> and <code>xsltproc</code> on your dev machine)</li>
</ul>
<pre><code>$ meson setup build -Dwith-manual=true -Dwith-tests=true -Dwith-docbook-path=/path/to/docbook
$ meson compile -C build
</code></pre>
<ul>
<li>Commit the regenerated troff man pages</li>
</ul>
<pre><code>$ git add man
$ git commit -a -m &quot;Generate manpages from XML&quot;
</code></pre>
<p>Read more about how to <a class="wikilink" href="/docs/work-with-Documentation.html">work with Documentation</a></p>
<ul>
<li>Run the distribution script, and fix any errors</li>
</ul>
<pre><code>$ cd build
$ meson dist
</code></pre>
<ul>
<li>Once the distribution builds cleanly, tag the release</li>
</ul>
<pre><code>$ git tag netatalk-3-2-0
$ git push origin netatalk-3-2-0
</code></pre>
<ul>
<li>
<p>Reset version to the &ldquo;dev&rdquo; version of the next planned release, e.g. <code>3.1.19dev</code></p>
</li>
<li>
<p>In the GitHub web interface, draft a new release. Choose the tag
    that you just pushed to the remote. Name the release and generate
    the release notes. Write a summary of the release, and touch up the changelog if needed.</p>
</li>
<li>
<p>Upload the xz compressed tarball and checksum file that were created in <code>./build/meson-dist</code></p>
</li>
<li>
<p>Commit updates to the html manual to the <a href="https://github.com/Netatalk/netatalk-homepage">netatalk-homepage</a> repository, generate html release notes, and author other release updates to the homepage.</p>
</li>
</ul>
<h3>Versioning Scheme</h3>
<p>This project uses a custom variant of <a href="https://semver.org/">Semantic Versioning</a>.</p>
<p>Given a version number <strong>MAJOR.MINOR.PATCH</strong>, increment the:</p>
<ol>
<li><strong>MAJOR</strong> version when you make incompatible API changes</li>
<li><strong>MINOR</strong> version when you add functionality, deprecate unused functionality, or introduce changes that require modification to configuration in existing deployment</li>
<li><strong>PATCH</strong> version when you make backward compatible bug fixes, or add minor functionality</li>
</ol>
<p>Historically, this project has used <strong>alpha</strong> and <strong>beta</strong> suffices for early major and minor releases, but this is not a practice at the time of writing.</p>
<h2>Docker</h2>
<p>Build and publish netatalk Docker images.</p>
<h3>Environment Preparation</h3>
<ol>
<li>
<p><a href="https://docs.docker.com/engine/install/">Install Docker Engine</a> in your development environment.</p>
</li>
<li>
<p>Create and enable a cross-compilation builder.</p>
</li>
</ol>
<pre><code>docker buildx create --name mybuilder --bootstrap --use
</code></pre>
<ol>
<li>
<p>Generate an auth token with your Docker Hub account (read/write/delete privileges).</p>
</li>
<li>
<p>Log in with your Docker Hub user, and pass the auth token when prompted.</p>
</li>
</ol>
<pre><code>docker login -u yourusername
</code></pre>
<ol>
<li>
<p>Cross compile Docker images with docker buildx, and push to the Docker Hub container registry. We currently cross compile for 32bit/64bit x86, and 32bit/64bit ARM.</p>
</li>
<li>
<p>Tag both &ldquo;latest&rdquo; as well as the current release version, e.g. &ldquo;3.2.0&rdquo;.</p>
</li>
</ol>
<pre><code>docker buildx build --push --platform=linux/386,linux/amd64,linux/arm/v6,linux/arm64 . -t netatalk/netatalk3:latest -t netatalk/netatalk3:3.2.0
</code></pre>
<ol>
<li>That&rsquo;s it! Confirm that the new image is published in the right repository: https://hub.docker.com/u/netatalk</li>
</ol>
<h2>Webmin Module</h2>
<p>If there are new or renamed config file options, or if some config file option has a new default, please update the <a href="https://github.com/Netatalk/netatalk-webmin">webmin-module</a> code, tag a new release, and create a release tarball.</p>
<p>Include a mention of the new webmin module release in the release notes for the new netatalk version.</p>
<h2>Debian deb packaging</h2>
<p>This section is written from the perspective of a Debian package maintainer, but can be leveraged to build your own deb package for personal use or unofficial distribution. Please note that this is just <em>one</em> of many ways to package software for Debian. When in doubt, refer to official Debian documentation rather than this section. </p>
<p>The modified Debian source code is managed in git in <a href="https://salsa.debian.org/netatalk-team/netatalk">Debian Salsa</a>. You can also get it with the <code>apt source netatalk</code> command (requires your release to have the package.)</p>
<h3>Environment prep</h3>
<p>First off, install all <a href="https://www.debian.org/doc/manuals/debmake-doc/ch03.en.html">Debian packaging tools</a> and configure the environment.</p>
<p>Then, read through the rest of the chapters in the linked manual before proceeding.</p>
<p>Leverage <a href="https://www.debian.org/doc/manuals/debmake-doc/ch07.en.html#chroot">chroot environments</a> to have a clean system for building and testing. Note that debuild will create deb packages for the specific OS version it is running on, so chroot enables you to control this.</p>
<p>If needed, set up <a href="https://wiki.debian.org/CrossCompiling">cross-compilation</a> to generate debs for architectures other than your actual machine.</p>
<h3>New netatalk release (automated)</h3>
<p>When working off the latest mainline release series (e.g. 3.x) you can use <code>gbp</code> to automate the process.</p>
<ol>
<li>If you don&rsquo;t have a remote called &ldquo;upstream&rdquo;, create it first <code>git remote add upstream https://github.com/Netatalk/netatalk.git</code></li>
<li>Fetch the latest references from upstream, <code>git fetch upstream</code></li>
<li>Merge the latest release tag, <code>gbp import-orig --upstream-vcs-tag=netatalk-x-y-z --uscan</code></li>
<li>Respond to the questions appropriately. A successful run should look something like this:</li>
</ol>
<pre><code>gbp:info: Launching uscan...
Newest version of netatalk on remote site is 3.2.0, local version is 3.1.18
       (mangled local version is 3.1.18)
 =&gt; Newer package available from:
        =&gt; https://github.com/Netatalk/netatalk/archive/refs/tags/netatalk-3-2-0.tar.gz
uscan warn: No files matched excluded pattern as the last matching glob: etc/spotlight/sparql_parser.c
uscan warn: No files matched excluded pattern as the last matching glob: etc/spotlight/sparql_parser.h
uscan warn: No files matched excluded pattern as the last matching glob: etc/spotlight/spotlight_rawquery_lexer.c
uscan warn: No files matched excluded pattern as the last matching glob: include/atalk/tdb.h
uscan warn: No files matched excluded pattern as the last matching glob: libatalk/talloc/talloc.c
uscan warn: No files matched excluded pattern as the last matching glob: libatalk/tdb/*
Successfully repacked ../netatalk--3-2-0.tar.gz as ../netatalk_3.2.0~ds.orig.tar.xz, deleting 1 files from itgbp:info: Using uscan downloaded tarball ../netatalk_3.2.0~ds.orig.tar.xz
What is the upstream version? [3.2.0~ds] 
gbp:info: Importing '../netatalk_3.2.0~ds.orig.tar.xz' to branch 'upstream/latest' (filtering out ['*/.git*'])...
gbp:info: Source package is netatalk
gbp:info: Upstream version is 3.2.0~ds
gbp:info: Replacing upstream source on 'debian/latest'
gbp:info: Successfully imported version 3.2.0~ds of ../netatalk_3.2.0~ds.orig.tar.xz
</code></pre>
<h3>New netatalk release (manual)</h3>
<p>When working off older branches, the following manual process can be used.</p>
<ol>
<li>Download the latest netatalk release tarball (should be non-bootstrapped)</li>
<li>Rename the tarball to match the debuild naming scheme, typically something like &ldquo;netatalk_3.1.18~ds.orig.tar.xz&rdquo;</li>
<li>In the same dir as the tarball, clone the Debian source (see above), then fetch the upstream references (create a new remote for the upstream git repo if needed.)</li>
<li>Check out the <code>upstream/latest</code> (or <code>upstream/old</code>) branch</li>
<li>Do a merge commit with the upstream release tag</li>
<li>Resolve any conflicts (typically due to the Debian source removing certain files.)</li>
<li>Tag <code>upstream/x.y.z_ds</code> (make sure you follow the naming convention)</li>
<li>Check out the <code>debian/latest</code> (or <code>debian/old</code>) branch</li>
<li>Do a merge commit with <code>upstream/x.y.z_ds</code></li>
<li>Resolve any conflicts</li>
<li>From the root of the Debian source, run <code>pristine-tar commit ../netatalk_x.y.z_ds.orig.tar.xz upstream/x.y.z_ds</code> to create a pristine tar commit in the &ldquo;pristine-tar&rdquo; branch</li>
</ol>
<h3>Local changes to the deb</h3>
<ol>
<li>Run <code>./debian/copyright-check</code> and commit any changes to &ldquo;./debian/copyright_hints&rdquo;</li>
<li>Manually merge relevant updates from &ldquo;copyright_hints&rdquo; to &ldquo;copyright&rdquo;</li>
<li>Make appropriate updates to any other files under &ldquo;debian/&rdquo;</li>
<li>Remove any obsoleted patches under &ldquo;debian/patches&rdquo;</li>
<li>Unfuzz patches that apply with fuzz, or not at all</li>
<li>If needed, <a href="https://www.debian.org/doc/manuals/debmake-doc/ch04.en.html#dquilt">create new patches</a> with <code>dquilt</code> and put them under &ldquo;debian/patches&rdquo;</li>
<li>From the root of the Debian source, run <code>dch -v x.y.z~ds-n</code> (with appropriate versioning numbers) to generate the changelog</li>
<li>Write the changelog and commit</li>
<li>From the root of the Debian source, run <code>debuild</code></li>
<li>If the build passes, check the lintian log</li>
<li>If there are any lintian warnings or errors, fix them</li>
<li>Test the created deb package in the parent directory by installing it with <code>dpgk</code></li>
<li>Tag the release <code>git tag x.y.z_ds-n</code></li>
<li>Push all branches (upstream/latest debian/latest pristine-tar) and tags (upstream/x.y.z debian/x.y.z_ds-n) to remote</li>
<li>You did it!</li>
</ol><hr />
    <p>
        This is a mirror of the Netatalk GitHub Wiki.
        Please <a href="https://github.com/Netatalk/netatalk/wiki/Release-Process">visit the original page</a>
        if you want to correct an error or contribute new contents.
    </p>
    <p>Last updated 2024-06-28</p>
    <hr />
    </div>
<div class="footer">
    <a href="https://validator.w3.org/check?uri=referer">
      <img src="https://www.w3.org/Icons/valid-xhtml10" alt="Valid XHTML 1.0 Strict" height="31" width="88" />
    </a>
    <a href="https://jigsaw.w3.org/css-validator/check?uri=referer">
      <img style="border:0;width:88px;height:31px"
      src="https://jigsaw.w3.org/css-validator/images/vcss" alt="Valid CSS!" />
    </a>
</div>
</body>
</html>

