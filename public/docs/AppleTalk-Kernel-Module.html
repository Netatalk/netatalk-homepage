<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Netatalk Wiki - AppleTalk Kernel Module</title>
    <meta name="description" content="Netatalk Wiki">
    <link rel="canonical" href="https://netatalk.io/docs/AppleTalk-Kernel-Module">
    <link rel="stylesheet" type="text/css" href="https://netatalk.io/css/site.css" />
    <link rel="icon" type="image/x-icon" href="https://netatalk.io/gfx/favicon.ico" />
</head>
<body>
<div id="header">
    <div id="logo"></div>
    <div id="menlinks">
        <a href="/" title="Return to Netatalk home">[main]</a>
        <a href="/docs" title="Netatalk Wiki">[wiki]</a>
        <a href="/documentation.html" title="Netatalk Manual">[documentation]</a>
        <a href="/download.html" title="Download Netatalk">[downloads]</a>
        <a href="/support.html" title="Support">[support]</a>
        <a href="/links.html" title="Netatalk related links">[links]</a>
        <img src="/gfx/end.gif" alt="" width="125" height="7" />
    </div>
</div>

<div id="header-print">
    <h1>netatalk.io</h1>
</div>

<div class="search">
    <h2>search netatalk.io</h2>
    <form method="get" action="https://www.google.com/search">
        <p>
            <input type="text" name="q" size="10" maxlength="255" value="" title="enter search text" />
            <input type="hidden" name="sitesearch" value="netatalk.io" />
            <input type="submit" name="btnG" value="Go" title="search netatalk.io" />
        </p>
    </form>
    <span class="italic">powered by Google</span>
</div>

<div id="navbars">
<div class="navbar">
<h2>Table of contents</h2>
<p>Resources</p>
<ul>
<li><a class="wikilink" href="/docs/FAQ.html">FAQ</a></li>
<li><a class="wikilink" href="/docs/Troubleshooting.html">Troubleshooting</a></li>
<li><a class="wikilink" href="/docs/Connect-to-AFP-Server.html">Connect to AFP Server</a></li>
<li><a class="wikilink" href="/docs/Webmin-Module.html">Webmin Module</a></li>
<li><a class="wikilink" href="/docs/Benchmarks.html">Benchmarks</a></li>
</ul>
<p>OS Specific Guides</p>
<ul>
<li><a class="wikilink" href="/docs/Installing-Netatalk-on-Alpine-Linux.html">Installing Netatalk on Alpine Linux</a></li>
<li><a class="wikilink" href="/docs/Installing-Netatalk-on-Debian-Linux.html">Installing Netatalk on Debian Linux</a></li>
<li><a class="wikilink" href="/docs/Installing-Netatalk-on-Fedora-Linux.html">Installing Netatalk on Fedora Linux</a></li>
<li><a class="wikilink" href="/docs/Installing-Netatalk-on-FreeBSD.html">Installing Netatalk on FreeBSD</a></li>
<li><a class="wikilink" href="/docs/Installing-Netatalk-on-macOS.html">Installing Netatalk on macOS</a></li>
<li><a class="wikilink" href="/docs/Installing-Netatalk-on-NetBSD.html">Installing Netatalk on NetBSD</a></li>
<li><a class="wikilink" href="/docs/Installing-Netatalk-on-OmniOS.html">Installing Netatalk on OmniOS</a></li>
<li><a class="wikilink" href="/docs/Installing-Netatalk-on-OpenBSD.html">Installing Netatalk on OpenBSD</a></li>
<li><a class="wikilink" href="/docs/Installing-Netatalk-on-OpenIndiana.html">Installing Netatalk on OpenIndiana</a></li>
<li><a class="wikilink" href="/docs/Installing-Netatalk-on-openSUSE.html">Installing Netatalk on openSUSE</a></li>
<li><a class="wikilink" href="/docs/Installing-Netatalk-on-Solaris.html">Installing Netatalk on Solaris</a></li>
<li><a class="wikilink" href="/docs/Installing-Netatalk-on-Ubuntu.html">Installing Netatalk on Ubuntu</a></li>
</ul>
<p>Technical Docs</p>
<ul>
<li><a class="wikilink" href="/docs/CatalogSearch.html">CatalogSearch</a></li>
<li><a class="wikilink" href="/docs/Kerberos.html">Kerberos</a></li>
<li><a class="wikilink" href="/docs/Special-Files-and-Folders.html">Special Files and Folders</a></li>
<li><a class="wikilink" href="/docs/Spotlight.html">Spotlight</a></li>
<li><a class="wikilink" href="/docs/AppleTalk-Kernel-Module.html">AppleTalk Kernel Module</a></li>
<li><a class="wikilink" href="/docs/Print-Server.html">Print Server</a></li>
<li><a class="wikilink" href="/docs/MacIP-Gateway.html">MacIP Gateway</a></li>
</ul>
<p>Development</p>
<ul>
<li><a class="wikilink" href="/docs/Developer-Notes.html">Developer Notes</a></li>
<li><a class="wikilink" href="/docs/Developer-FAQ.html">Developer FAQ</a></li>
<li><a class="wikilink" href="/docs/Work-with-Documentation.html">Work with Documentation</a></li>
<li><a class="wikilink" href="/docs/Release-Process.html">Release Process</a></li>
<li><a class="wikilink" href="/docs/Using-GDB-to-Analyze-a-Crash.html">Using GDB to Analyze a Crash</a></li>
</ul>
</div></div>
<div id="content">
<h1 id="AppleTalk-Kernel-Module">AppleTalk Kernel Module</h1><hr/>
<h1>AppleTalk Kernel Module</h1>
<p>Netatalk relies on AppleTalk support in the kernel to make use of the DDP transport layer. The <code>atalkd</code> daemon will attempt to dynamically load the kernel module if not detected, and errors out with the following message if all attempts fail:</p>
<pre><code>Address family not supported by protocol
</code></pre>
<p>You can still use Netatalk&rsquo;s DSI transport layer (TCP/IP) without AppleTalk support in the kernel.</p>
<p>At the time of writing, Linux and NetBSD are known to have actively maintained AppleTalk kernel modules. Many distros, notably Alpine, Debian, and Ubuntu, all ship with the AppleTalk module enabled out of the box.</p>
<p>Other distros, such as Fedora, may have an active blacklisting in the default configuration that needs to be disabled first. See the <a class="wikilink" href="/docs/Installing-Netatalk-on-Fedora-Linux.html">Installing Netatalk on Fedora Linux</a> guide for more info.</p>
<h2>Linux</h2>
<p>To check if your kernel has AppleTalk support, first start the <code>atalkd</code> daemon, then issue this command and inspect the output:</p>
<pre><code>$ lsmod | grep appletalk
</code></pre>
<p>If no <code>appletalk</code> module is detected, you may have to compile support into the kernel. This section describes the modular approach, but it should also be possible to compile the AppleTalk module directly into the kernel for a slight performance boost.</p>
<h3>Compiling from source</h3>
<p>This section will not describe the entire process, but rather follow the steps in the <a href="https://www.raspberrypi.com/documentation/computers/linux_kernel.html">Raspberry Pi documentation</a>. Do the steps in the documentation in this order:</p>
<ul>
<li><a href="https://www.raspberrypi.com/documentation/computers/linux_kernel.html#building-the-kernel-locally">Building the Kernel Locally</a></li>
<li><a href="https://www.raspberrypi.com/documentation/computers/linux_kernel.html#default_configuration">Apply the Default Configuration</a></li>
<li><a href="https://www.raspberrypi.com/documentation/computers/linux_kernel.html#preparing-to-configure">Preparing to Configure</a></li>
<li><a href="https://www.raspberrypi.com/documentation/computers/linux_kernel.html#using-menuconfig">Using menuconfig</a></li>
<li>Networking support &mdash;&gt; Networking options &mdash;&gt; Appletalk protocol support<ul>
<li>Press M to select this</li>
<li>Select <strong>Appletalk interfaces support</strong> and press M again</li>
<li>Save and exit menuconfig</li>
</ul>
</li>
<li><a href="https://www.raspberrypi.com/documentation/computers/linux_kernel.html#building-the-kernel">Building the Kernel</a></li>
<li>Reboot the system once the process is completed (compilation may take an hour or longer on slower systems)</li>
<li>Check that the <code>appletalk</code> kernel module has been loaded, as per the above</li>
<li>If the module isn&rsquo;t automatically loaded, add a line to /etc/modules<ul>
<li>appletalk</li>
</ul>
</li>
</ul>
<h3>Broadcast packets handling issue</h3>
<p>The module in Linux kernel v6.8 and earlier has a known bug with multi-interface routing. In short, the bug will cause <code>atalkd</code> to send responses on the first socket listening on port 6 that it finds, regardless of which interface packets originated from. This may lead to devices on the network not consistently showing up in the Chooser on Mac clients on the same network. E.g. appearing and then disappearing. </p>
<p>There is a <a href="https://gist.github.com/VinDuv/4db433b6dce39d51a5b7847ee749b2a4">patch</a> for this bug available that you can apply if this affects you. The patch has been <a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=2e82a58d6c0797092eabe7ba66a532c11548047f">accepted into the Linux kernel</a> and is included as of v6.9.</p>
<h2>NetBSD</h2>
<p>The NetBSD kernel comes with an AppleTalk kernel module, confusingly named &ldquo;netatalk&rdquo;, located under <code>sys/netatalk</code> in the kernel source tree.</p>
<p>The AppleTalk kernel module is available in NetBSD&rsquo;s default configuration, and should work with <code>atalkd</code> out of the box.</p>
<h2>Solaris</h2>
<p>Older versions of Netatalk (final: 2.3) distributed code for an AppleTalk module for Solaris (SPARC architecture), located under <code>sys/solaris</code> in the netatalk source tree. It has not been confirmed working with contemporary Solaris releases.</p><hr />
    <p>
        This is a mirror of the Netatalk GitHub Wiki.
        Please <a href="https://github.com/Netatalk/netatalk/wiki/AppleTalk-Kernel-Module">visit the original page</a>
        if you want to correct an error or contribute new contents.
    </p>
    <p>Last updated 2024-10-31</p>
    <hr />
    </div>
<div class="footer">
    <a href="https://validator.w3.org/check?uri=referer">
      <img src="https://www.w3.org/Icons/valid-xhtml10" alt="Valid XHTML 1.0 Strict" height="31" width="88" />
    </a>
    <a href="https://jigsaw.w3.org/css-validator/check?uri=referer">
      <img style="border:0;width:88px;height:31px"
      src="https://jigsaw.w3.org/css-validator/images/vcss" alt="Valid CSS!" />
    </a>
    <p>Netatalk is licensed under the <a href="/stable/htmldocs/gpl">GNU
    General Public License 2.0</a>.</p>
</div>
</body>
</html>
