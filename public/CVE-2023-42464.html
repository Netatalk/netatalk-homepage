<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="description" content="Netatalk - Unix file and print services for Apple clients" />
<meta
  name="keywords"
  content="Netatalk, AFP, AFP Server, File Server, PAP, Print Server, AppleTalk, Mac, OSX, OS X, OS9, OS 9, macOS" />
<meta name="language" content="EN" />
<meta name="publisher" content="netatalk.io" />
<meta name="robots" content="index,follow" />
<meta name="audience" content="all" />

<link rel="stylesheet" type="text/css" href="css/site.css" />
<link rel="stylesheet" type="text/css" href="css/printer.css" media="print" />
<link rel="alternate stylesheet" type="text/css" href="css/printer.css" title="Printer" />
<link
  rel="copyright"
  title="GNU General Public License, version 2"
  href="https://www.gnu.org/licenses/old-licenses/gpl-2.0.html" />
<link rel="author" title="The Netatalk Development Team" href="http://netatalk.io" />
<link rel="help" href="/3.1/htmldocs/" title="Documentation" />
<link rel="home" href="index.html" title="Netatalk Home" />
<link rel="home" href="https://github.com/Netatalk/netatalk" title="Netatalk GitHub" />
<link rel="bookmark" href="/3.1/htmldocs/" title="Netatalk Documentation" />
<link rel="bookmark" href="https://github.com/Netatalk/netatalk/wiki" title="wiki" />
<link rel="bookmark" href="https://sourceforge.net/projects/netatalk/files/" title="Downloads" />
<link rel="icon" type="image/x-icon" href="/gfx/favicon.ico" />

<title>Netatalk - CVE-2023-42464</title>
</head>
<body>
<div id="header">
    <div id="logo"></div>
    <div id="menlinks">
        <a href="/" title="Return to Netatalk home">[main]</a>
        <a href="/docs" title="Netatalk Wiki">[wiki]</a>
        <a href="/documentation.html" title="Netatalk Manual">[documentation]</a>
        <a href="/download.html" title="Download Netatalk">[downloads]</a>
        <a href="/support.html" title="Support">[support]</a>
        <a href="/links.html" title="Netatalk related links">[links]</a>
        <img src="/gfx/end.gif" alt="" width="125" height="7" />
    </div>
</div>

<div id="header-print">
    <h1>netatalk.io</h1>
</div>

<div class="search">
    <h2>search netatalk.io</h2>
    <form method="get" action="https://www.google.com/search">
        <p>
            <input type="text" name="q" size="10" maxlength="255" value="" title="enter search text" />
            <input type="hidden" name="sitesearch" value="netatalk.io" />
            <input type="submit" name="btnG" value="Go" title="search netatalk.io" />
        </p>
    </form>
    <span class="italic">powered by Google</span>
</div>

<div id="navbars">
  <div class="navbar">
    <h2>current releases</h2>
    <p><b>stable</b></p>
    <ul>
      <li>
        <a
        title="download 3.1.18 xz compressed"
        href="https://sourceforge.net/projects/netatalk/files/netatalk-3-1-18/netatalk-3.1.18.tar.xz/download">
        3.1.18 (xz)
        </a>
      </li>
      <li>
        <a
        title="download 3.1.18 bzip2 compressed"
        href="https://sourceforge.net/projects/netatalk/files/netatalk-3-1-18/netatalk-3.1.18.tar.bz2/download">
        3.1.18 (bzip2)
        </a>
      </li>
      <li>
        <a
        title="view 3.1.18 Release Notes"
        href="/3.1/ReleaseNotes3.1.18.html">
        Release Notes
        </a>
      </li>
    </ul>
    <p><b>old stable (AppleTalk)</b></p>
    <ul>
      <li>
        <a
        title="download 2.3.1 xz compressed"
        href="https://sourceforge.net/projects/netatalk/files/netatalk-2-3-1/netatalk-2.3.1.tar.xz/download">
        2.3.1 (xz)
        </a>
      </li>
      <li>
        <a
        title="download 2.3.1 bzip2 compressed"
        href="https://sourceforge.net/projects/netatalk/files/netatalk-2-3-1/netatalk-2.3.1.tar.bz2/download">
        2.3.1 (bzip2)
        </a>
      </li>
      <li>
        <a
        title="view 2.3.1 Release Notes"
        href="/2.3/ReleaseNotes2.3.1.html">
        Release Notes
        </a>
      </li>
    </ul>
  </div>
  <div class="navbar">
    <h2>documentation</h2>
    <h3><b>3.1 manual</b></h3>
    <ol>
      <li><a href="/3.1/htmldocs/intro.html">Introduction</a></li>
      <li><a href="/3.1/htmldocs/installation.html">Installation</a></li>
      <li><a href="/3.1/htmldocs/configuration.html">Configuration</a></li>
      <li><a href="/3.1/htmldocs/upgrade.html">Upgrading</a></li>
      <li><a href="/3.1/htmldocs/man-pages.html">Man Pages</a></li>
    </ol>
    <h3><b>2.3 manual</b></h3>
    <ol>
      <li><a href="/2.3/htmldocs/intro.html">Introduction</a></li>
      <li><a href="/2.3/htmldocs/installation.html">Installation</a></li>
      <li><a href="/2.3/htmldocs/configuration.html">Configuration</a></li>
      <li><a href="/2.3/htmldocs/upgrade.html">Upgrading</a></li>
      <li><a href="/2.3/htmldocs/man-pages.html">Man Pages</a></li>
    </ol>
  </div>
  <div class="navbar">
    <h2>community</h2>
       <h3><a title="Mailing Lists" href="https://sourceforge.net/p/netatalk/mailman/">Mailing Lists</a></h3>
       <h3><a title="Wiki" href="https://github.com/Netatalk/netatalk/wiki">Wiki</a></h3>
       <h3><a title="Discussions" href="https://github.com/Netatalk/netatalk/discussions">Discussions</a></h3>
  </div>
  <div class="navbar">
    <h2>development</h2>
       <h3><a title="Code Repository" href="https://github.com/Netatalk/netatalk">Code Repository</a></h3>
       <h3><a title="How to Contribute" href="https://netatalk.io/docs/Developer-Notes.html">
        How to Contribute</a></h3>
    <p><a href="https://sonarcloud.io/summary/overall?id=Netatalk_netatalk">
      <img alt="Sonarcloud Scan Build Status" height="30"
         src="https://sonarcloud.io/images/project_badges/sonarcloud-orange.svg"/>
    </a></p>
  </div>
</div>


<div id="content">
<h1>Netatalk Security Advisory</h1>

<dl>
<dt><strong>Subject</strong></dt>
<dd>afpd daemon vulnerable to type confusion</dd>
<dt><strong>CVE ID</strong></dt>
<dd>CVE-2023-42464</dd>
<dt><strong>Date of Publishing</strong></dt>
<dd>2023/09/17</dd>
<dt><strong>Affected Versions</strong></dt>
<dd>Netatalk 3.1.0 through 3.1.16</dd>
<dt><strong>Summary</strong></dt>
<dd>A Type Confusion vulnerability was found in the Spotlight RPC functions in Netatalk's afpd daemon.</dd>
</dl>
<h2>Description</h2>
<p>A Type Confusion vulnerability was found in the Spotlight RPC functions in Netatalk's afpd daemon. When parsing Spotlight RPC packets, one encoded data structure is a key-value style dictionary where the keys are character strings, and the values can be any of the supported types in the underlying protocol. Due to a lack of type checking in callers of the dalloc_value_for_key() function, which returns the object associated with a key, a malicious actor may be able to fully control the value of the pointer and theoretically achieve Remote Code Execution on the host.</p>

<p>The underlying code for Spotlight queries in Netatalk shares a common heritage with Samba, and hence the root cause and fix are logically identical with those described in CVE-2023-34967.</p>

<h2>Patch Availability</h2>
<p>A patch addressing this vulnerability has been published at: <a href="https://github.com/Netatalk/netatalk/commit/a0ee3c246ee9e082436192290610a4d812fc0b7f.diff">https://github.com/Netatalk/netatalk/commit/a0ee3c246ee9e082436192290610a4d812fc0b7f.diff</a></p>

<p>Additionally, Netatalk 3.1.17 has been released which contains the security patch. Netatalk administrators are advised to upgrade to this version or apply the patch as soon as possible.</p>

<h2>CVSSv3 Calculation</h2>
<p>CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:L (5.3)</p>

<h2>Workaround</h2>
<p>Spotlight is an optional feature in Netatalk, and is disabled by default. If you previously enabled Spotlight and want to disable it, set "spotlight = no" in your afp.conf.</p>

<h2>Credits</h2>
<p>Credits to finding and demonstrating the exploit goes to:</p>
<p>Florent Saudel, Arnaud Gatignol of @thalium_team</p>

<p>Patch by Daniel Markstedt of the Netatalk Team, based on work by Ralph Boehme of the Samba Team.</p>
<div class="footer">
    <a href="https://validator.w3.org/check?uri=referer">
      <img src="https://www.w3.org/Icons/valid-xhtml10" alt="Valid XHTML 1.0 Strict" height="31" width="88" />
    </a>
    <a href="https://jigsaw.w3.org/css-validator/check?uri=referer">
      <img style="border:0;width:88px;height:31px"
      src="https://jigsaw.w3.org/css-validator/images/vcss" alt="Valid CSS!" />
    </a>
</div>
</body>
</html>

