<?php
 $title = "CVE-2023-42464";
 include "header.php";
?>

<div id="content">
<h1>Netatalk Security Advisory</h1>

<dl>
<dt><strong>Subject</strong></dt>
<dd>afpd daemon vulnerable to type confusion</dd>
<dt><strong>CVE ID</strong></dt>
<dd>CVE-2023-42464</dd>
<dt><strong>Date of Publishing</strong></dt>
<dd>2023/09/17</dd>
<dt><strong>Affected Versions</strong></dt>
<dd>Netatalk 3.1.0 through 3.1.16</dd>
<dt><strong>Summary</strong></dt>
<dd>A Type Confusion vulnerability was found in the Spotlight RPC functions in Netatalk's afpd daemon.</dd>
</dl>
<h2>Description</h2>
<p>A Type Confusion vulnerability was found in the Spotlight RPC functions in Netatalk's afpd daemon. When parsing Spotlight RPC packets, one encoded data structure is a key-value style dictionary where the keys are character strings, and the values can be any of the supported types in the underlying protocol. Due to a lack of type checking in callers of the dalloc_value_for_key() function, which returns the object associated with a key, a malicious actor may be able to fully control the value of the pointer and theoretically achieve Remote Code Execution on the host.</p>

<p>The underlying code for Spotlight queries in Netatalk shares a common heritage with Samba, and hence the root cause and fix are logically identical with those described in CVE-2023-34967.</p>

<h2>Patch Availability</h2>
<p>A patch addressing this vulnerability has been published at: <a href="https://github.com/Netatalk/netatalk/commit/a0ee3c246ee9e082436192290610a4d812fc0b7f.diff">https://github.com/Netatalk/netatalk/commit/a0ee3c246ee9e082436192290610a4d812fc0b7f.diff</a></p>

<p>Additionally, Netatalk 3.1.17 has been released which contains the security patch. Netatalk administrators are advised to upgrade to this version or apply the patch as soon as possible.</p>

<h2>CVSSv3 Calculation</h2>
<p>CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:L (5.3)</p>

<h2>Workaround</h2>
<p>Spotlight is an optional feature in Netatalk, and is disabled by default. If you previously enabled Spotlight and want to disable it, set "spotlight = no" in your afp.conf.</p>

<h2>Credits</h2>
<p>Credits to finding and demonstrating the exploit goes to:</p>
<p>Florent Saudel, Arnaud Gatignol of @thalium_team</p>

<p>Patch by Daniel Markstedt of the Netatalk Team, based on work by Ralph Boehme of the Samba Team.</p>

<?php include "footer.php"; ?>
